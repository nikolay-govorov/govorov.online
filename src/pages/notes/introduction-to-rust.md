---
name: introduction-to-rust
title: "Приправляем наши web проекты Rust'ом"
date: 2017-10-02
---
Это вводная статья в язык Rust, призванная разобраться нужен ли он вам, и чем он может быть полезен в веб разработке.

Наверняка ты сталкивался с ситуацией, когда приложение выросло, а производительность упала. Может быть у тебя есть сложные алгоритмы надолго блокирующие поток и требующие много процессорного времени. Ты тратишь силы, но проведённые оптимизации не дают ощутимого результата (особенно если у тебя node).

Иногда случается что web-приложению внезапно потребовался доступ к низкоуровневому API системы (например, для dashboard'а с нестандартными метриками системы). Особняком стоит проблема многопоточности. Python и Ruby готовят её плохо, NodeJS не готовит вовсе. А порой хочется.

Важное требование в том, что мы не хотим переписывать весь проект. Мы лишь хотим ускорить узкие места. Самым логичным решением кажется **вынести тяжёлую логику в нативные модули**.

Прежде чем бежать и нанимать С++ разработчика, я прошу тебя остановиться и хорошенько подумать.

Мы привыкли, что С/C++ — must have системной разработки, но, чёрт возьми, давай посмотрим правде в глаза — писать на С++ больно. Мы постоянно стрелляем себе по ногам, валимся с ошибками памяти, пишем тысячи строк кода для очередного велосипеда, а про поддержку зависимостей вообще лучше не вспоминать. Помимо этого разработка кроссплатформенных и переносимых решений требует много лишних телодвижений.

Вебу нужен новый ~~геморрой~~ герой!

В документации к Rust написано, что Rust — это системный язык программирования, внимание которого сосредоточено на трёх задачах: безопасность, скорость и параллелизм ([Подробнее](http://rurust.github.io/rust_book_ru/src/INTRODUCTION.html)).

Важно отметить что Rust создавался в компании Mozilla как замена С++ для разработки ядра браузера Firefox. 

### Что необычного может Rust:

**Читаемый синтаксис**. Rust — язык программирования созданный для разработчиков. Код на нём действительно приятно читать. Например, так может выглядеть Hello Rust:

```rust
fn main() {
    println!("Hello Rust!");
}
```

**Скорость**. Собственно, ради этого всё и затевалось. Rust чертвоски быстр, почти так же как и С++, и, само собой, в разы быстрее любого из скриптовых языков.

**Развитый workflow**. Что удивительно, но удобство разработки и качество инструментов не уступает ни Python, ни Ruby, а о С++ даже речи не идёт. Пакетный менеджер [Cargo](https://crates.io/) берёт на себя все вопросы с зависимостями и даже сборкой проектов. Создание нового проекта — одна команда `$ cargo new --bin my_app`. Можно забыть про сложные Make-файлы, это всё сделано из коробки, просто нажимай `$ cargo build` или `$ cargo build --release`. Иными словами, в нашем распоряжении есть всё что нужно: пакетные менеджеры, сборщики, готовые модули для типичных задач.

**Продуманное тестирование**. В самом простом случае, тест в Rust — это функция, аннотированная атрибутом test:

```rust
#[test]
fn it_works() {
    assert!(true);
}
```

Это смотрится просто очевидно и поставляется из коробки. Можете забыть про многочасовую настройку фреймворков для тестирования. Как можно было догадаться, запускать тесты можно одной командой `$ cargo test`.

**Многопоточность**. Это пожалуй основная киллер-фича Rust и одна из целей его создания. Многопточность, с защитой от гонки данных делается в несколько строк:

```rust
use std::thread;

fn process() {
    let handles: Vec<_> = (0..10).map(|_| {
        thread::spawn(|| {
            let mut x = 0;

            for _ in 0..5_000_000 {
                x += 1
            }

            x
        })
    }).collect();

    for h in handles {
        println!("Поток завершился со счётом={}",

        h.join().map_err(|_| "Не удалось соединиться с потоком!").unwrap());
    }
}
```

Более интересные примеры есть в [Книге](http://rurust.github.io/rust_book_ru/src/dining-philosophers.html).

**Переносимость и кроссплатформенность**. Об этом стоит сказать отдельно. Как уже было сказано, сборку берёт на себя Cargo. Он позволяет очень легко и стандартизированно собирать проекты в динамически библиотеки (.so или .dll), что бы потом подключать их в существующий код. Гарантируется что библиотека будет соблюдать стандарт [FFI](https://en.wikipedia.org/wiki/Foreign_function_interface), а значит мы не завязаны на одной платформе и можем легко перенести биндинг из проекта на python, в проект на node или даже С++. Это ключевое преимущество перед нативными биндингами основанных на стандартах вроде [N-API](https://nodejs.org/api/addons.html#addons_n_api). [Подробнее](http://rurust.github.io/rust_book_ru/src/rust-inside-other-languages.html)

**Web Assembler**. Да, так как Rust компилируемый язык без сборщика мусора, он может компилироваться в wasm и эффективно использоваться на клиенте.

**Документация**. Это стоит вынести в отдельное преимущество. У языка отличная, хорошо структурированная документация. Много инфомации переведено на русский язык.

Язык Rust всё ещё находится на стадии активной разработки, но уже сейчас может помочь в разработке сложных высоконагруженных приложений.

На этом всё. Я надёюсь что пробудил у вас желание ближе познакомиться с этим языком.

## Библиотека:

- [Официальный сайт Rust](https://www.rust-lang.org)
- [Перевод книги "The Rust Programming Language"](http://rurust.github.io/rust_book_ru) 
- [NodeJS native modules with Rust](https://blog.risingstack.com/node-js-native-modules-with-rust/)
- [Rust lets get it started](https://medium.com/learning-rust/rust-lets-get-it-started-bdd8de58178d)
- [Как работает Web Assembler](https://habrahabr.ru/company/ruvds/blog/343568/?utm_source=twitter.com&utm_medium=social&utm_campaign=[perevod]-kak-rabotaet-js-osobennosti-i) 
